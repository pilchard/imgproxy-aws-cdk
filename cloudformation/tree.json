{
  "version": "tree-0.1",
  "tree": {
    "id": "App",
    "path": "",
    "children": {
      "ImgproxyStack": {
        "id": "ImgproxyStack",
        "path": "ImgproxyStack",
        "children": {
          "stack-generated-default-bucket": {
            "id": "stack-generated-default-bucket",
            "path": "ImgproxyStack/stack-generated-default-bucket",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/stack-generated-default-bucket/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::S3::Bucket",
                  "aws:cdk:cloudformation:props": {
                    "bucketEncryption": {
                      "serverSideEncryptionConfiguration": [
                        {
                          "serverSideEncryptionByDefault": {
                            "sseAlgorithm": "AES256"
                          }
                        }
                      ]
                    },
                    "bucketName": "imgproxystack-bucket",
                    "publicAccessBlockConfiguration": {
                      "blockPublicAcls": true,
                      "blockPublicPolicy": true,
                      "ignorePublicAcls": true,
                      "restrictPublicBuckets": true
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.CfnBucket",
                  "version": "2.178.1"
                }
              },
              "Policy": {
                "id": "Policy",
                "path": "ImgproxyStack/stack-generated-default-bucket/Policy",
                "children": {
                  "Resource": {
                    "id": "Resource",
                    "path": "ImgproxyStack/stack-generated-default-bucket/Policy/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::S3::BucketPolicy",
                      "aws:cdk:cloudformation:props": {
                        "bucket": {
                          "Ref": "stackgenerateddefaultbucket0D3205AE"
                        },
                        "policyDocument": {
                          "Statement": [
                            {
                              "Action": "s3:*",
                              "Condition": {
                                "Bool": {
                                  "aws:SecureTransport": "false"
                                }
                              },
                              "Effect": "Deny",
                              "Principal": {
                                "AWS": "*"
                              },
                              "Resource": [
                                {
                                  "Fn::GetAtt": [
                                    "stackgenerateddefaultbucket0D3205AE",
                                    "Arn"
                                  ]
                                },
                                {
                                  "Fn::Join": [
                                    "",
                                    [
                                      {
                                        "Fn::GetAtt": [
                                          "stackgenerateddefaultbucket0D3205AE",
                                          "Arn"
                                        ]
                                      },
                                      "/*"
                                    ]
                                  ]
                                }
                              ]
                            }
                          ],
                          "Version": "2012-10-17"
                        }
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_s3.CfnBucketPolicy",
                      "version": "2.178.1"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3.BucketPolicy",
                  "version": "2.178.1",
                  "metadata": []
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_s3.Bucket",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "OriginalImagesS3Bucket": {
            "id": "OriginalImagesS3Bucket",
            "path": "ImgproxyStack/OriginalImagesS3Bucket",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.178.1"
            }
          },
          "imgproxy-lamda-role": {
            "id": "imgproxy-lamda-role",
            "path": "ImgproxyStack/imgproxy-lamda-role",
            "children": {
              "Importimgproxy-lamda-role": {
                "id": "Importimgproxy-lamda-role",
                "path": "ImgproxyStack/imgproxy-lamda-role/Importimgproxy-lamda-role",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.178.1",
                  "metadata": []
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/imgproxy-lamda-role/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                  "aws:cdk:cloudformation:props": {
                    "assumeRolePolicyDocument": {
                      "Statement": [
                        {
                          "Action": "sts:AssumeRole",
                          "Effect": "Allow",
                          "Principal": {
                            "Service": "lambda.amazonaws.com"
                          }
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "managedPolicyArns": [
                      {
                        "Fn::Join": [
                          "",
                          [
                            "arn:",
                            {
                              "Ref": "AWS::Partition"
                            },
                            ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                          ]
                        ]
                      },
                      {
                        "Fn::Join": [
                          "",
                          [
                            "arn:",
                            {
                              "Ref": "AWS::Partition"
                            },
                            ":iam::aws:policy/AWSXrayWriteOnlyAccess"
                          ]
                        ]
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Role",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "read-write-bucket-policy": {
            "id": "read-write-bucket-policy",
            "path": "ImgproxyStack/read-write-bucket-policy",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/read-write-bucket-policy/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::IAM::Policy",
                  "aws:cdk:cloudformation:props": {
                    "policyDocument": {
                      "Statement": [
                        {
                          "Action": [
                            "cloudwatch:PutMetricData",
                            "cloudwatch:PutMetricStream"
                          ],
                          "Effect": "Allow",
                          "Resource": "*",
                          "Sid": "CloudWatch"
                        },
                        {
                          "Action": "ssm:GetParametersByPath",
                          "Effect": "Allow",
                          "Resource": {
                            "Fn::Join": [
                              "",
                              [
                                "arn:aws:ssm:",
                                {
                                  "Ref": "AWS::Region"
                                },
                                ":",
                                {
                                  "Ref": "AWS::AccountId"
                                },
                                ":parameter/imgproxy/dev"
                              ]
                            ]
                          },
                          "Sid": "SystemsManagerAccess"
                        },
                        {
                          "Action": [
                            "s3:GetObject",
                            "s3:GetObjectVersion"
                          ],
                          "Effect": "Allow",
                          "Resource": {
                            "Fn::Join": [
                              "",
                              [
                                {
                                  "Fn::GetAtt": [
                                    "stackgenerateddefaultbucket0D3205AE",
                                    "Arn"
                                  ]
                                },
                                "/*"
                              ]
                            ]
                          },
                          "Sid": "S3Access"
                        }
                      ],
                      "Version": "2012-10-17"
                    },
                    "policyName": "readwritebucketpolicyDCD4CB5F",
                    "roles": [
                      {
                        "Ref": "imgproxylamdarole82646660"
                      }
                    ]
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.CfnPolicy",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_iam.Policy",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "imgproxy-ecr-repository": {
            "id": "imgproxy-ecr-repository",
            "path": "ImgproxyStack/imgproxy-ecr-repository",
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_ecr.RepositoryBase",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "imgproxy": {
            "id": "imgproxy",
            "path": "ImgproxyStack/imgproxy",
            "children": {
              "ServiceRole": {
                "id": "ServiceRole",
                "path": "ImgproxyStack/imgproxy/ServiceRole",
                "children": {
                  "ImportServiceRole": {
                    "id": "ImportServiceRole",
                    "path": "ImgproxyStack/imgproxy/ServiceRole/ImportServiceRole",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.Resource",
                      "version": "2.178.1",
                      "metadata": []
                    }
                  },
                  "Resource": {
                    "id": "Resource",
                    "path": "ImgproxyStack/imgproxy/ServiceRole/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                      "aws:cdk:cloudformation:props": {
                        "assumeRolePolicyDocument": {
                          "Statement": [
                            {
                              "Action": "sts:AssumeRole",
                              "Effect": "Allow",
                              "Principal": {
                                "Service": "lambda.amazonaws.com"
                              }
                            }
                          ],
                          "Version": "2012-10-17"
                        },
                        "managedPolicyArns": [
                          {
                            "Fn::Join": [
                              "",
                              [
                                "arn:",
                                {
                                  "Ref": "AWS::Partition"
                                },
                                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                              ]
                            ]
                          }
                        ]
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                      "version": "2.178.1"
                    }
                  },
                  "DefaultPolicy": {
                    "id": "DefaultPolicy",
                    "path": "ImgproxyStack/imgproxy/ServiceRole/DefaultPolicy",
                    "children": {
                      "Resource": {
                        "id": "Resource",
                        "path": "ImgproxyStack/imgproxy/ServiceRole/DefaultPolicy/Resource",
                        "attributes": {
                          "aws:cdk:cloudformation:type": "AWS::IAM::Policy",
                          "aws:cdk:cloudformation:props": {
                            "policyDocument": {
                              "Statement": [
                                {
                                  "Action": [
                                    "xray:PutTelemetryRecords",
                                    "xray:PutTraceSegments"
                                  ],
                                  "Effect": "Allow",
                                  "Resource": "*"
                                }
                              ],
                              "Version": "2012-10-17"
                            },
                            "policyName": "imgproxyServiceRoleDefaultPolicyBB9560AF",
                            "roles": [
                              {
                                "Ref": "imgproxyServiceRole01C2399E"
                              }
                            ]
                          }
                        },
                        "constructInfo": {
                          "fqn": "aws-cdk-lib.aws_iam.CfnPolicy",
                          "version": "2.178.1"
                        }
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_iam.Policy",
                      "version": "2.178.1",
                      "metadata": []
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.Role",
                  "version": "2.178.1",
                  "metadata": []
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/imgproxy/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Function",
                  "aws:cdk:cloudformation:props": {
                    "architectures": [
                      "arm64"
                    ],
                    "code": {
                      "imageUri": {
                        "Fn::Join": [
                          "",
                          [
                            "825765411384.dkr.ecr.us-east-1.",
                            {
                              "Ref": "AWS::URLSuffix"
                            },
                            "/imgproxy:latest"
                          ]
                        ]
                      }
                    },
                    "environment": {
                      "variables": {
                        "PORT": "8080",
                        "IMGPROXY_LOG_FORMAT": "json",
                        "IMGPROXY_ENV_AWS_SSM_PARAMETERS_PATH": "/imgproxy/dev",
                        "IMGPROXY_CLOUD_WATCH_SERVICE_NAME": "ImgproxyStack",
                        "IMGPROXY_CLOUD_WATCH_NAMESPACE": "imgproxy",
                        "IMGPROXY_CLOUD_WATCH_REGION": {
                          "Ref": "AWS::Region"
                        },
                        "IMGPROXY_USE_S3": "1"
                      }
                    },
                    "functionName": "ImgproxyStack",
                    "loggingConfig": {
                      "logFormat": "JSON"
                    },
                    "memorySize": 2048,
                    "packageType": "Image",
                    "role": {
                      "Fn::GetAtt": [
                        "imgproxyServiceRole01C2399E",
                        "Arn"
                      ]
                    },
                    "timeout": 60,
                    "tracingConfig": {
                      "mode": "Active"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnFunction",
                  "version": "2.178.1"
                }
              },
              "LogRetention": {
                "id": "LogRetention",
                "path": "ImgproxyStack/imgproxy/LogRetention",
                "children": {
                  "Resource": {
                    "id": "Resource",
                    "path": "ImgproxyStack/imgproxy/LogRetention/Resource",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.CfnResource",
                      "version": "2.178.1"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_logs.LogRetention",
                  "version": "2.178.1"
                }
              },
              "LogGroup": {
                "id": "LogGroup",
                "path": "ImgproxyStack/imgproxy/LogGroup",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.Resource",
                  "version": "2.178.1",
                  "metadata": []
                }
              },
              "FunctionUrl": {
                "id": "FunctionUrl",
                "path": "ImgproxyStack/imgproxy/FunctionUrl",
                "children": {
                  "Resource": {
                    "id": "Resource",
                    "path": "ImgproxyStack/imgproxy/FunctionUrl/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::Lambda::Url",
                      "aws:cdk:cloudformation:props": {
                        "authType": "AWS_IAM",
                        "invokeMode": "RESPONSE_STREAM",
                        "targetFunctionArn": {
                          "Fn::GetAtt": [
                            "imgproxy40EEB6C5",
                            "Arn"
                          ]
                        }
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_lambda.CfnUrl",
                      "version": "2.178.1"
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.FunctionUrl",
                  "version": "2.178.1",
                  "metadata": []
                }
              },
              "AllowCloudFrontServicePrincipal": {
                "id": "AllowCloudFrontServicePrincipal",
                "path": "ImgproxyStack/imgproxy/AllowCloudFrontServicePrincipal",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::Lambda::Permission",
                  "aws:cdk:cloudformation:props": {
                    "action": "lambda:InvokeFunctionUrl",
                    "functionName": {
                      "Fn::GetAtt": [
                        "imgproxy40EEB6C5",
                        "Arn"
                      ]
                    },
                    "principal": "cloudfront.amazonaws.com",
                    "sourceArn": {
                      "Fn::Join": [
                        "",
                        [
                          "arn:aws:cloudfront::",
                          {
                            "Ref": "AWS::AccountId"
                          },
                          ":distribution/",
                          {
                            "Ref": "imageDeliveryDistribution8CA0B45D"
                          }
                        ]
                      ]
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_lambda.CfnPermission",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_lambda.Function",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a": {
            "id": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a",
            "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a",
            "children": {
              "Code": {
                "id": "Code",
                "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code",
                "children": {
                  "Stage": {
                    "id": "Stage",
                    "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/Stage",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.AssetStaging",
                      "version": "2.178.1"
                    }
                  },
                  "AssetBucket": {
                    "id": "AssetBucket",
                    "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/AssetBucket",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_s3.BucketBase",
                      "version": "2.178.1",
                      "metadata": []
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_s3_assets.Asset",
                  "version": "2.178.1"
                }
              },
              "ServiceRole": {
                "id": "ServiceRole",
                "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole",
                "children": {
                  "ImportServiceRole": {
                    "id": "ImportServiceRole",
                    "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/ImportServiceRole",
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.Resource",
                      "version": "2.178.1",
                      "metadata": []
                    }
                  },
                  "Resource": {
                    "id": "Resource",
                    "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource",
                    "attributes": {
                      "aws:cdk:cloudformation:type": "AWS::IAM::Role",
                      "aws:cdk:cloudformation:props": {
                        "assumeRolePolicyDocument": {
                          "Statement": [
                            {
                              "Action": "sts:AssumeRole",
                              "Effect": "Allow",
                              "Principal": {
                                "Service": "lambda.amazonaws.com"
                              }
                            }
                          ],
                          "Version": "2012-10-17"
                        },
                        "managedPolicyArns": [
                          {
                            "Fn::Join": [
                              "",
                              [
                                "arn:",
                                {
                                  "Ref": "AWS::Partition"
                                },
                                ":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"
                              ]
                            ]
                          }
                        ]
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_iam.CfnRole",
                      "version": "2.178.1"
                    }
                  },
                  "DefaultPolicy": {
                    "id": "DefaultPolicy",
                    "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy",
                    "children": {
                      "Resource": {
                        "id": "Resource",
                        "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource",
                        "attributes": {
                          "aws:cdk:cloudformation:type": "AWS::IAM::Policy",
                          "aws:cdk:cloudformation:props": {
                            "policyDocument": {
                              "Statement": [
                                {
                                  "Action": [
                                    "logs:DeleteRetentionPolicy",
                                    "logs:PutRetentionPolicy"
                                  ],
                                  "Effect": "Allow",
                                  "Resource": "*"
                                }
                              ],
                              "Version": "2012-10-17"
                            },
                            "policyName": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB",
                            "roles": [
                              {
                                "Ref": "LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"
                              }
                            ]
                          }
                        },
                        "constructInfo": {
                          "fqn": "aws-cdk-lib.aws_iam.CfnPolicy",
                          "version": "2.178.1"
                        }
                      }
                    },
                    "constructInfo": {
                      "fqn": "aws-cdk-lib.aws_iam.Policy",
                      "version": "2.178.1",
                      "metadata": []
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_iam.Role",
                  "version": "2.178.1",
                  "metadata": []
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnResource",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.4.2"
            }
          },
          "urlRewrite": {
            "id": "urlRewrite",
            "path": "ImgproxyStack/urlRewrite",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/urlRewrite/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::CloudFront::Function",
                  "aws:cdk:cloudformation:props": {
                    "autoPublish": true,
                    "functionCode": "const crypto=require(\"crypto\");const cf=require(\"cloudfront\");const imgproxyKey=\"dev.key\";const imgproxySalt=\"dev.salt\";const imgproxyArgumentsSeparotor=\"dev.arguments_separator\";const indexedOptions={resize:{full:\"resize\",short:\"rs\",meta:true,metaOptions:[\"resizing_type\",\"width\",\"height\",\"enlarge\",\"extend\"]},rs:{full:\"resize\",short:\"rs\",meta:true,metaOptions:[\"resizing_type\",\"width\",\"height\",\"enlarge\",\"extend\"]},size:{full:\"size\",short:\"s\",meta:true,metaOptions:[\"width\",\"height\",\"enlarge\",\"extend\"]},s:{full:\"size\",short:\"s\",meta:true,metaOptions:[\"width\",\"height\",\"enlarge\",\"extend\"]},resizing_type:{full:\"resizing_type\",short:\"rt\"},rt:{full:\"resizing_type\",short:\"rt\"},width:{full:\"width\",short:\"w\"},w:{full:\"width\",short:\"w\"},height:{full:\"height\",short:\"h\"},h:{full:\"height\",short:\"h\"},min_width:{full:\"min_width\",short:\"mw\"},mw:{full:\"min_width\",short:\"mw\"},min_height:{full:\"min_height\",short:\"mh\"},mh:{full:\"min_height\",short:\"mh\"},zoom:{full:\"zoom\",short:\"z\"},z:{full:\"zoom\",short:\"z\"},dpr:{full:\"dpr\",short:\"dpr\"},enlarge:{full:\"enlarge\",short:\"el\"},el:{full:\"enlarge\",short:\"el\"},extend:{full:\"extend\",short:\"ex\"},ex:{full:\"extend\",short:\"ex\"},extend_aspect_ratio:{full:\"extend_aspect_ratio\",short:\"exar\",alt:\"extend_ar\"},exar:{full:\"extend_aspect_ratio\",short:\"exar\",alt:\"extend_ar\"},extend_ar:{full:\"extend_aspect_ratio\",short:\"exar\",alt:\"extend_ar\"},gravity:{full:\"gravity\",short:\"g\"},g:{full:\"gravity\",short:\"g\"},crop:{full:\"crop\",short:\"c\"},c:{full:\"crop\",short:\"c\"},trim:{full:\"trim\",short:\"t\"},t:{full:\"trim\",short:\"t\"},padding:{full:\"padding\",short:\"pd\"},pd:{full:\"padding\",short:\"pd\"},auto_rotate:{full:\"auto_rotate\",short:\"ar\"},ar:{full:\"auto_rotate\",short:\"ar\"},rotate:{full:\"rotate\",short:\"rot\"},rot:{full:\"rotate\",short:\"rot\"},background:{full:\"background\",short:\"bg\"},bg:{full:\"background\",short:\"bg\"},blur:{full:\"blur\",short:\"bl\"},bl:{full:\"blur\",short:\"bl\"},sharpen:{full:\"sharpen\",short:\"sh\"},sh:{full:\"sharpen\",short:\"sh\"},pixelate:{full:\"pixelate\",short:\"pix\"},pix:{full:\"pixelate\",short:\"pix\"},watermark:{full:\"watermark\",short:\"wm\"},wm:{full:\"watermark\",short:\"wm\"},strip_metadata:{full:\"strip_metadata\",short:\"sm\"},sm:{full:\"strip_metadata\",short:\"sm\"},keep_copyright:{full:\"keep_copyright\",short:\"kcr\"},kcr:{full:\"keep_copyright\",short:\"kcr\"},strip_color_profile:{full:\"strip_color_profile\",short:\"scp\"},scp:{full:\"strip_color_profile\",short:\"scp\"},enforce_thumbnail:{full:\"enforce_thumbnail\",short:\"eth\"},eth:{full:\"enforce_thumbnail\",short:\"eth\"},quality:{full:\"quality\",short:\"q\"},q:{full:\"quality\",short:\"q\"},format_quality:{full:\"format_quality\",short:\"fq\"},fq:{full:\"format_quality\",short:\"fq\"},max_bytes:{full:\"max_bytes\",short:\"mb\"},mb:{full:\"max_bytes\",short:\"mb\"},format:{full:\"format\",short:\"f\",alt:\"ext\"},f:{full:\"format\",short:\"f\",alt:\"ext\"},ext:{full:\"format\",short:\"f\",alt:\"ext\"},skip_processing:{full:\"skip_processing\",short:\"skp\"},skp:{full:\"skip_processing\",short:\"skp\"},raw:{full:\"raw\",short:\"raw\"},cache_buster:{full:\"cache_buster\",short:\"cb\"},cb:{full:\"cache_buster\",short:\"cb\"},expires:{full:\"expires\",short:\"exp\"},exp:{full:\"expires\",short:\"exp\"},filename:{full:\"filename\",short:\"fn\"},fn:{full:\"filename\",short:\"fn\"},return_attachment:{full:\"return_attachment\",short:\"att\"},att:{full:\"return_attachment\",short:\"att\"},preset:{full:\"preset\",short:\"pr\"},pr:{full:\"preset\",short:\"pr\"},max_src_resolution:{full:\"max_src_resolution\",short:\"msr\"},msr:{full:\"max_src_resolution\",short:\"msr\"},max_src_file_size:{full:\"max_src_file_size\",short:\"msfs\"},msfs:{full:\"max_src_file_size\",short:\"msfs\"},max_animation_frames:{full:\"max_animation_frames\",short:\"maf\"},maf:{full:\"max_animation_frames\",short:\"maf\"},max_animation_frame_resolution:{full:\"max_animation_frame_resolution\",short:\"mafr\"},mafr:{full:\"max_animation_frame_resolution\",short:\"mafr\"}};function validate_signature(t,r,e,o){if(!_verify(t,r,e,o)){throw new Error(\"Signature verification failed\")}}function _verify(t,r,e,o){return _stringTimingSafeEqual(o,_sign(t,r,e))}function _stringTimingSafeEqual(t,r){if(t.length!==r.length){return false}const e=Buffer.from(t,\"utf8\");const o=Buffer.from(r,\"utf8\");let s=0;for(let t=0;t<e.length;t++){s|=e[t]^o[t]}return 0===s}function _sign(t,r,e){const o=crypto.createHmac(\"sha256\",_hexDecode(e));o.update(_hexDecode(t));o.update(r);return o.digest(\"base64url\")}function _hexDecode(t){return Buffer.from(t,\"hex\")}function _trimSeparators(t){return t.replaceAll(/^\\/|\\/$/g,\"\")}async function handler(t){const r=t.request;const e=await getEnvironmentVariables();if(e.none!==undefined){return sendError(403,\"Forbidden\",\"\",e.none)}const o=e.some.IMGPROXY_SALT;const s=e.some.IMGPROXY_KEY;const l=e.some.IMGPROXY_ARGUMENTS_SEPARATOR;const n=new RegExp(`^\\\\/([^\\\\/]+)\\\\/((?:[a-z]+\\\\${l}[^\\\\/]+\\\\/)+)?(plain\\\\/|enc\\\\/)?(.+)`,\"g\");const i=n.exec(r.uri);if(i===null){return sendError(403,\"Forbidden\",\"\",new Error(\"Unable to parse URI\"))}if(i[1]===undefined){return sendError(403,\"Forbidden\",\"\",new Error(\"Signature is missing from URI\"))}const a=i[1];const f=i[2]!==undefined?i[2]:\"\";const u=i[3]!==undefined?i[3]:\"\";const h=i[4]!==undefined?i[4]:\"\";try{validate_signature(o,`/${f}${u}${h}`,s,a)}catch(t){return sendError(403,\"Forbidden\",\"\",new Error(\"Signature verification failed\",{cause:t}))}const c=Object.create(null);const m=_trimSeparators(f).split(\"/\");for(let t=0;t<m.length;t++){const r=m[t];const e=r.split(l);const o=e.shift();const s=e;if(o!==undefined&&s.length>0){const t=indexedOptions[o];if(t!==undefined){if(t.meta!==undefined){const r=t.metaOptions;for(let t=0;t<r.length;t++){const e=r[t];if(s[t]!==undefined){const o=t===r.length-1?s.slice(t):[s[t]];const n=indexedOptions[e];if(n!==undefined){const t=n.short!==undefined?n.short:e;delete c[t];c[t]=o.join(l)}}}}else{const r=t.short!==undefined?t.short:o;delete c[r];c[r]=s.join(l)}}}}const _=[];const d=Object.entries(c);for(let t=0;t<d.length;t++){const r=d[t];_.push(r.join(l))}const p=_.join(\"/\");const g=`/${p}/${u}${h}`;const x=`/${_sign(o,g,s)}${g}`;r.uri=x;return r}async function getEnvironmentVariables(){const t=cf.kvs();try{const r=await t.get(imgproxySalt,{format:\"string\"});const e=await t.get(imgproxyKey,{format:\"string\"});const o=await t.get(imgproxyArgumentsSeparotor,{format:\"string\"});return{some:{IMGPROXY_SALT:r,IMGPROXY_KEY:e,IMGPROXY_ARGUMENTS_SEPARATOR:o}}}catch(t){return{none:new Error(\"Failed to retrieve value from key value store\",{cause:t})}}}function sendError(t,r,e,o){logError(e,o);return{statusCode:t,statusText:r,body:e}}function logError(t,r){console.log(\"APPLICATION ERROR\",t);console.log(r)}export{};\n",
                    "functionConfig": {
                      "comment": "urlRewriteFunctionc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
                      "runtime": "cloudfront-js-1.0"
                    },
                    "name": "urlRewriteFunctionc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea"
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_cloudfront.CfnFunction",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_cloudfront.Function",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "ImageCachePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea": {
            "id": "ImageCachePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
            "path": "ImgproxyStack/ImageCachePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/ImageCachePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::CloudFront::CachePolicy",
                  "aws:cdk:cloudformation:props": {
                    "cachePolicyConfig": {
                      "name": {
                        "Fn::Join": [
                          "",
                          [
                            "ImgproxyStackImageCachePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1eaC55EBFCC-",
                            {
                              "Ref": "AWS::Region"
                            }
                          ]
                        ]
                      },
                      "minTtl": 0,
                      "maxTtl": 31536000,
                      "defaultTtl": 31536000,
                      "parametersInCacheKeyAndForwardedToOrigin": {
                        "cookiesConfig": {
                          "cookieBehavior": "none"
                        },
                        "headersConfig": {
                          "headerBehavior": "whitelist",
                          "headers": [
                            "Accept"
                          ]
                        },
                        "enableAcceptEncodingGzip": false,
                        "enableAcceptEncodingBrotli": false,
                        "queryStringsConfig": {
                          "queryStringBehavior": "none"
                        }
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_cloudfront.CfnCachePolicy",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_cloudfront.CachePolicy",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "ResponseHeadersPolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea": {
            "id": "ResponseHeadersPolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
            "path": "ImgproxyStack/ResponseHeadersPolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
            "children": {
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/ResponseHeadersPolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::CloudFront::ResponseHeadersPolicy",
                  "aws:cdk:cloudformation:props": {
                    "responseHeadersPolicyConfig": {
                      "name": "ImageResponsePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
                      "corsConfig": {
                        "accessControlAllowCredentials": false,
                        "accessControlAllowHeaders": {
                          "items": [
                            "*"
                          ]
                        },
                        "accessControlAllowMethods": {
                          "items": [
                            "GET"
                          ]
                        },
                        "accessControlAllowOrigins": {
                          "items": [
                            "*"
                          ]
                        },
                        "accessControlMaxAgeSec": 600,
                        "originOverride": false
                      },
                      "customHeadersConfig": {
                        "items": [
                          {
                            "header": "x-aws-imgproxy",
                            "value": "v1.0",
                            "override": true
                          },
                          {
                            "header": "vary",
                            "value": "accept",
                            "override": true
                          }
                        ]
                      }
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_cloudfront.CfnResponseHeadersPolicy",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_cloudfront.ResponseHeadersPolicy",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "imageDeliveryDistribution": {
            "id": "imageDeliveryDistribution",
            "path": "ImgproxyStack/imageDeliveryDistribution",
            "children": {
              "Origin1": {
                "id": "Origin1",
                "path": "ImgproxyStack/imageDeliveryDistribution/Origin1",
                "constructInfo": {
                  "fqn": "constructs.Construct",
                  "version": "10.4.2"
                }
              },
              "Resource": {
                "id": "Resource",
                "path": "ImgproxyStack/imageDeliveryDistribution/Resource",
                "attributes": {
                  "aws:cdk:cloudformation:type": "AWS::CloudFront::Distribution",
                  "aws:cdk:cloudformation:props": {
                    "distributionConfig": {
                      "enabled": true,
                      "origins": [
                        {
                          "domainName": {
                            "Fn::Select": [
                              0,
                              {
                                "Fn::Split": [
                                  "/",
                                  {
                                    "Fn::Select": [
                                      1,
                                      {
                                        "Fn::Split": [
                                          "//",
                                          {
                                            "Fn::GetAtt": [
                                              "imgproxyFunctionUrlB6DEF4E7",
                                              "FunctionUrl"
                                            ]
                                          }
                                        ]
                                      }
                                    ]
                                  }
                                ]
                              }
                            ]
                          },
                          "id": "ImgproxyStackimageDeliveryDistributionOrigin1FC1433F0",
                          "customOriginConfig": {
                            "originSslProtocols": [
                              "TLSv1.2"
                            ],
                            "originProtocolPolicy": "https-only"
                          },
                          "originShield": {
                            "enabled": true,
                            "originShieldRegion": "us-east-1"
                          }
                        }
                      ],
                      "defaultCacheBehavior": {
                        "pathPattern": "*",
                        "targetOriginId": "ImgproxyStackimageDeliveryDistributionOrigin1FC1433F0",
                        "cachePolicyId": {
                          "Ref": "ImageCachePolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1eaC8B08AFC"
                        },
                        "compress": false,
                        "responseHeadersPolicyId": {
                          "Ref": "ResponseHeadersPolicyc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea8C4478B8"
                        },
                        "viewerProtocolPolicy": "redirect-to-https",
                        "functionAssociations": [
                          {
                            "functionArn": {
                              "Fn::GetAtt": [
                                "urlRewriteD6DE1501",
                                "FunctionARN"
                              ]
                            },
                            "eventType": "viewer-request"
                          }
                        ]
                      },
                      "comment": "imgproxy - image delivery",
                      "httpVersion": "http2",
                      "ipv6Enabled": true
                    }
                  }
                },
                "constructInfo": {
                  "fqn": "aws-cdk-lib.aws_cloudfront.CfnDistribution",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_cloudfront.Distribution",
              "version": "2.178.1",
              "metadata": []
            }
          },
          "OAC": {
            "id": "OAC",
            "path": "ImgproxyStack/OAC",
            "attributes": {
              "aws:cdk:cloudformation:type": "AWS::CloudFront::OriginAccessControl",
              "aws:cdk:cloudformation:props": {
                "originAccessControlConfig": {
                  "name": "oacc8daa9c9b40e4ae4f79684d979f190abc66c56b1ea",
                  "originAccessControlOriginType": "lambda",
                  "signingBehavior": "always",
                  "signingProtocol": "sigv4"
                }
              }
            },
            "constructInfo": {
              "fqn": "aws-cdk-lib.aws_cloudfront.CfnOriginAccessControl",
              "version": "2.178.1"
            }
          },
          "ImageDeliveryDomain": {
            "id": "ImageDeliveryDomain",
            "path": "ImgproxyStack/ImageDeliveryDomain",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnOutput",
              "version": "2.178.1"
            }
          },
          "CDKMetadata": {
            "id": "CDKMetadata",
            "path": "ImgproxyStack/CDKMetadata",
            "children": {
              "Default": {
                "id": "Default",
                "path": "ImgproxyStack/CDKMetadata/Default",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnResource",
                  "version": "2.178.1"
                }
              },
              "Condition": {
                "id": "Condition",
                "path": "ImgproxyStack/CDKMetadata/Condition",
                "constructInfo": {
                  "fqn": "aws-cdk-lib.CfnCondition",
                  "version": "2.178.1"
                }
              }
            },
            "constructInfo": {
              "fqn": "constructs.Construct",
              "version": "10.4.2"
            }
          },
          "BootstrapVersion": {
            "id": "BootstrapVersion",
            "path": "ImgproxyStack/BootstrapVersion",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnParameter",
              "version": "2.178.1"
            }
          },
          "CheckBootstrapVersion": {
            "id": "CheckBootstrapVersion",
            "path": "ImgproxyStack/CheckBootstrapVersion",
            "constructInfo": {
              "fqn": "aws-cdk-lib.CfnRule",
              "version": "2.178.1"
            }
          }
        },
        "constructInfo": {
          "fqn": "aws-cdk-lib.Stack",
          "version": "2.178.1"
        }
      },
      "Tree": {
        "id": "Tree",
        "path": "Tree",
        "constructInfo": {
          "fqn": "constructs.Construct",
          "version": "10.4.2"
        }
      }
    },
    "constructInfo": {
      "fqn": "aws-cdk-lib.App",
      "version": "2.178.1"
    }
  }
}